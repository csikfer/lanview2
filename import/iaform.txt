
SET REPLACE;

TABLE online_alarms SHAPE uaalarms  "Nem nyugtázott riasztások" {
    SET DEFAULTS;               // Az összes mező felvétele alapértelmezett tulajdonságokkal
    TABLE TYPE BARE;
    TABLE TITLE "Nem nyugtázott riasztások";
    //      online                        Nincs nyugtázva                                       zónán bellül
    REFINE "? = ANY (online_user_ids) AND COALESCE(array_length(ack_user_ids, 1) = 0, true) AND is_group_place(place_id, ?):user_id:place_group_id";
    TABLE VIEW   RIGHTS indalarm;
    TABLE EDIT   RIGHTS system;
    TABLE INSERT RIGHTS system;
    TABLE DELETE RIGHTS admin;
    
    FIELD online_alarm_id   { FLAG ON HIDE;                                                                     }
    FIELD host_service_name { FLAG ON HIDE TABLE;   TITLE ,         "Felügyelő objektum neve";                  } 
    FIELD node_name         {                       TITLE "Eszköz", "Eszköz neve";                              }
    FIELD node_id           { FLAG ON HIDE;                                                                     }
    FIELD place_name        {                       TITLE "Hely",   "Az eszköz helye";                          }
    FIELD place_id          { FLAG ON HIDE;                                                                     }
    FIELD superior_alarm_id { FLAG ON HIDE;                                                                     }
    FIELD begin_time        {                       TITLE "Kezdete","A riasztás kezdete";                       }
    FIELD end_time          {                       TITLE "Vége",   "A riasztási állpot vége";                  }
    FIELD first_status      { FLAG ON HIDE TABLE;   TITLE ,         "Állapot a riasztás kezdetén";              }
    FIELD max_status        { FLAG ON HIDE TABLE;   TITLE ,         "A legsújosabb állapot a riasztás alatt";   }
    FIELD last_status       { FLAG ON HIDE TABLE;   TITLE ,         "Az utolsó állapot a riasztás alatt";       }
    FIELD event_note        { FLAG ON HIDE TABLE;   TITLE ,         "Az állapothoz csatolt üzenet";             }
    FIELD msg               { FLAG ON HUGE;         TITLE "Üzenet", "Riasztási üzenet";                         } 
    FIELD online_user_ids   { FLAG ON HIDE TABLE;   TITLE ,         "Értesítendő felhasználók";                 }
    FIELD notice_user_ids   { FLAG ON HIDE TABLE;   TITLE ,         "Felhasználók láthatták a riasztást";       }
    FIELD view_user_ids     { FLAG ON HIDE TABLE;   TITLE ,         "Felhasználók megnézték a riasztást";       }
    FIELD ack_user_ids      { FLAG ON HIDE;                                                                     }
    AUTO REFRESH "0:05:00";
    TABLE FEATURES ":max_rows=500:";   // Nincs (nem kéne) lapozás, de tul nagy tábla akkor sem lehet
}

TABLE online_alarms SHAPE aaalarms "Nyugtázott aktív riasztások" {
    SET DEFAULTS;               // Az összes mező felvétele alapértelmezett tulajdonságokkal
    TABLE TYPE BARE;
    TABLE TITLE "Nyugtázott és aktív riasztások";
    //      online                        Nyugtázva,                     de még fennál a riasztási állpot, és zónán bellül
    REFINE "? = ANY (online_user_ids) AND array_length(ack_user_ids, 1) > 0 AND end_time IS NULL AND is_group_place(place_id, ?):user_Id:place_group_id";
    TABLE VIEW   RIGHTS indalarm;
    TABLE EDIT   RIGHTS system;
    TABLE INSERT RIGHTS system;
    TABLE DELETE RIGHTS admin;
    FIELD online_alarm_id   { FLAG ON HIDE;                                                                     }
    FIELD host_service_name { FLAG ON HIDE TABLE;   TITLE ,         "Felügyelő objektum neve";                  } 
    FIELD node_name         {                       TITLE "Eszköz", "Eszköz neve";                              }
    FIELD node_id           { FLAG ON HIDE;                                                                     }
    FIELD place_name        {                       TITLE "Hely",   "Az eszköz helye";                          }
    FIELD place_id          { FLAG ON HIDE;                                                                     }
    FIELD superior_alarm_id { FLAG ON HIDE TABLE;   TITLE ,         "Fő felügyelő objektum neve";               }
    FIELD begin_time        {                       TITLE "Kezdete","A riasztás kezdete";                       }
    FIELD end_time          { FLAG ON HIDE;                                                                     }
    FIELD first_status      { FLAG ON HIDE TABLE;   TITLE ,         "Állapot a riasztás kezdetén";              }
    FIELD max_status        { FLAG ON HIDE TABLE;   TITLE ,         "A legsújosabb állapot a riasztás alatt";   }
    FIELD last_status       { FLAG ON HIDE TABLE;   TITLE ,         "Az utolsó állapot a riasztás alatt";       }
    FIELD event_note        { FLAG ON HIDE TABLE;   TITLE ,         "Az állapothoz csatolt üzenet";             }
    FIELD msg               { FLAG ON HUGE;         TITLE "Üzenet", "Riasztási üzenet";                         } 
    FIELD online_user_ids   { FLAG ON HIDE TABLE;   TITLE ,         "Értesítendő felhasználók";                 }
    FIELD notice_user_ids   { FLAG ON HIDE TABLE;   TITLE ,         "Felhasználók láthatták a riasztást";       }
    FIELD view_user_ids     { FLAG ON HIDE TABLE;   TITLE ,         "Felhasználók megnézték a riasztást";       }
    FIELD ack_user_ids      {                       TITLE "Nyugtázta",@;                                        }
    AUTO REFRESH "0:05:00";
}

DELETE SERVICE TYPE life_sign;
SERVICE TYPE life_sign "Jelenlét érzékelés";
SET services [rlinkstat, attached].service_type_id = ID SERVICE TYPE(life_sign);

SERVICE TYPE life_sign MESSAGE {
    warning                             : "Letíltva"    "Az érzékelés letíltva, állapot ismeretlen";
    down                                : "Nincs jelen" "Az eszköz jelenléte nem érzékelhető";
    critical, unreachable,unknown       : "Ismeretlen"  "Az érzékelő állpota ismeretlen, hibás, az eszköz jelenléte nem ismert";
    flapping                            : "Billeg"      "Az érzékelő állapota változó, billeg, további riasztások letiltva.";
}

